# Secure Squid Configuration

# Network configuration
http_port 3128

# Access Control Lists

# Define allowed networks (internal networks only)
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10

# Whitelist of allowed domains
acl whitelist dstdomain "/etc/squid/whitelist.txt"

# SSL_ports for HTTPS
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443

# Allow only Safe_ports
http_access deny !Safe_ports

# Deny SSL_ports (except 443)
http_access deny CONNECT !SSL_ports

# Whitelist enforcement - only allow whitelisted domains
http_access deny !whitelist

# Allow access from localnet
http_access allow localnet

# Deny everything else
http_access deny all

# Logging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log

# Disable caching for security
cache deny all

# Disable cache_dir (no disk storage)
cache_dir null /tmp

# No persistent cache
cache_mem 8 MB

# Maximum object size (0 = no caching)
maximum_object_size 0 KB

# Security settings
forwarded_for delete
via off

# Connection settings
client_lifetime 1 hour
pconn_timeout 1 minute
connect_timeout 1 minute
request_timeout 5 minutes

# DNS settings
dns_nameservers 8.8.8.8 8.8.4.4

# Disable ICP
icp_port 0

# Disable ident lookups
ident_lookup_access deny all
